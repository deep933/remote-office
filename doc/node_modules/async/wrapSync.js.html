<!DOCTYPE html>
<html>
<head>
  <title>wrapSync.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/async/wrapSync.js";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>wrapSync.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">'use strict'</span>;

<span class="hljs-built_in">Object</span>.defineProperty(exports, <span class="hljs-string">"__esModule"</span>, {
    <span class="hljs-attr">value</span>: <span class="hljs-literal">true</span>
});
exports.default = asyncify;

<span class="hljs-keyword">var</span> _isObject = <span class="hljs-built_in">require</span>(<span class="hljs-string">'lodash/isObject'</span>);

<span class="hljs-keyword">var</span> _isObject2 = _interopRequireDefault(_isObject);

<span class="hljs-keyword">var</span> _initialParams = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./internal/initialParams'</span>);

<span class="hljs-keyword">var</span> _initialParams2 = _interopRequireDefault(_initialParams);

<span class="hljs-keyword">var</span> _setImmediate = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./internal/setImmediate'</span>);

<span class="hljs-keyword">var</span> _setImmediate2 = _interopRequireDefault(_setImmediate);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_interopRequireDefault</span>(<span class="hljs-params">obj</span>) </span>{ <span class="hljs-keyword">return</span> obj &amp;&amp; obj.__esModule ? obj : { <span class="hljs-attr">default</span>: obj }; }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
<p>Take a sync function and make it async, passing its return value to a
callback. This is useful for plugging sync functions into a waterfall,
series, or other async functions. Any arguments passed to the generated
function will be passed to the wrapped function (except for the final
callback argument). Errors thrown will be passed to the callback.</p>
</div>
<div class="body">
<p>If the function passed to <code>asyncify</code> returns a Promise, that promises's
resolved/rejected state will be used to call the callback, rather than simply
the synchronous return value.</p>
<p>This also means you can asyncify ES2017 <code>async</code> functions.</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">func</span>
<span class="dox_type">Function</span>
<span><ul>
<li>The synchronous function, or Promise-returning function to convert to an {@link AsyncFunction}.</li>
</ul>
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">asyncify</span>(<span class="hljs-params">func</span>) </span>{
    <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span>, _initialParams2.default)(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">args, callback</span>) </span>{
        <span class="hljs-keyword">var</span> result;
        <span class="hljs-keyword">try</span> {
            result = func.apply(<span class="hljs-keyword">this</span>, args);
        } <span class="hljs-keyword">catch</span> (e) {
            <span class="hljs-keyword">return</span> callback(e);
        }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>if result is Promise object</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">if</span> ((<span class="hljs-number">0</span>, _isObject2.default)(result) &amp;&amp; <span class="hljs-keyword">typeof</span> result.then === <span class="hljs-string">'function'</span>) {
            result.then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) </span>{
                invokeCallback(callback, <span class="hljs-literal">null</span>, value);
            }, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{
                invokeCallback(callback, err.message ? err : <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(err));
            });
        } <span class="hljs-keyword">else</span> {
            callback(<span class="hljs-literal">null</span>, result);
        }
    });
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">invokeCallback</span>(<span class="hljs-params">callback, error, value</span>) </span>{
    <span class="hljs-keyword">try</span> {
        callback(error, value);
    } <span class="hljs-keyword">catch</span> (e) {
        (<span class="hljs-number">0</span>, _setImmediate2.default)(rethrow, e);
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rethrow</span>(<span class="hljs-params">error</span>) </span>{
    <span class="hljs-keyword">throw</span> error;
}
<span class="hljs-built_in">module</span>.exports = exports[<span class="hljs-string">'default'</span>];
</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
