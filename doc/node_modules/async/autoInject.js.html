<!DOCTYPE html>
<html>
<head>
  <title>autoInject.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/async/autoInject.js";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>autoInject.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">'use strict'</span>;

<span class="hljs-built_in">Object</span>.defineProperty(exports, <span class="hljs-string">"__esModule"</span>, {
    <span class="hljs-attr">value</span>: <span class="hljs-literal">true</span>
});
exports.default = autoInject;

<span class="hljs-keyword">var</span> _auto = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./auto'</span>);

<span class="hljs-keyword">var</span> _auto2 = _interopRequireDefault(_auto);

<span class="hljs-keyword">var</span> _baseForOwn = <span class="hljs-built_in">require</span>(<span class="hljs-string">'lodash/_baseForOwn'</span>);

<span class="hljs-keyword">var</span> _baseForOwn2 = _interopRequireDefault(_baseForOwn);

<span class="hljs-keyword">var</span> _arrayMap = <span class="hljs-built_in">require</span>(<span class="hljs-string">'lodash/_arrayMap'</span>);

<span class="hljs-keyword">var</span> _arrayMap2 = _interopRequireDefault(_arrayMap);

<span class="hljs-keyword">var</span> _isArray = <span class="hljs-built_in">require</span>(<span class="hljs-string">'lodash/isArray'</span>);

<span class="hljs-keyword">var</span> _isArray2 = _interopRequireDefault(_isArray);

<span class="hljs-keyword">var</span> _trim = <span class="hljs-built_in">require</span>(<span class="hljs-string">'lodash/trim'</span>);

<span class="hljs-keyword">var</span> _trim2 = _interopRequireDefault(_trim);

<span class="hljs-keyword">var</span> _wrapAsync = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./internal/wrapAsync'</span>);

<span class="hljs-keyword">var</span> _wrapAsync2 = _interopRequireDefault(_wrapAsync);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_interopRequireDefault</span>(<span class="hljs-params">obj</span>) </span>{ <span class="hljs-keyword">return</span> obj &amp;&amp; obj.__esModule ? obj : { <span class="hljs-attr">default</span>: obj }; }

<span class="hljs-keyword">var</span> FN_ARGS = <span class="hljs-regexp">/^(?:async\s+)?(function)?\s*[^\(]*\(\s*([^\)]*)\)/m</span>;
<span class="hljs-keyword">var</span> FN_ARG_SPLIT = <span class="hljs-regexp">/,/</span>;
<span class="hljs-keyword">var</span> FN_ARG = <span class="hljs-regexp">/(=.+)?(\s*)$/</span>;
<span class="hljs-keyword">var</span> STRIP_COMMENTS = <span class="hljs-regexp">/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseParams</span>(<span class="hljs-params">func</span>) </span>{
    func = func.toString().replace(STRIP_COMMENTS, <span class="hljs-string">''</span>);
    func = func.match(FN_ARGS)[<span class="hljs-number">2</span>].replace(<span class="hljs-string">' '</span>, <span class="hljs-string">''</span>);
    func = func ? func.split(FN_ARG_SPLIT) : [];
    func = func.map(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">arg</span>) </span>{
        <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span>, _trim2.default)(arg.replace(FN_ARG, <span class="hljs-string">''</span>));
    });
    <span class="hljs-keyword">return</span> func;
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
<p>A dependency-injected version of the [async.auto]{@link module:ControlFlow.auto} function. Dependent
tasks are specified as parameters to the function, after the usual callback
parameter, with the parameter names matching the names of the tasks it
depends on. This can provide even more readable task graphs which can be
easier to maintain.</p>
</div>
<div class="body">
<p>If a final callback is specified, the task results are similarly injected,
specified as named parameters after the initial error parameter.</p>
<p>The autoInject function is purely syntactic sugar and its semantics are
otherwise equivalent to [async.auto]{@link module:ControlFlow.auto}.</p>
</div>
<div class="details">
<div class="dox_tag_title">See</div>
<div class="dox_tag_detail">
<span class="dox_type">[async.auto]{@link module:ControlFlow.auto}</span>
</div>
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">tasks</span>
<span class="dox_type">Object</span>
<span><ul>
<li>An object, each of whose properties is an {@link AsyncFunction} of the form 'func([dependencies...], callback). The object's key of a property
serves as the name of the task defined by that property, i.e. can be used
when specifying requirements for other tasks.</li>
</ul>
<ul>
<li>The <code>callback</code> parameter is a <code>callback(err, result)</code> which must be called
when finished, passing an <code>error</code> (which can be <code>null</code>) and the result of
the function's execution. The remaining parameters name other tasks on
which the task is dependent, and the results from those tasks are the
arguments of those parameters.</li>
</ul>
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[callback]</span>
<span class="dox_type">Function</span>
<span><ul>
<li>An optional callback which is called when all the tasks have been completed. It receives the <code>err</code> argument if any <code>tasks</code>
pass an error to their callback, and a <code>results</code> object with any completed
task results, similar to <code>auto</code>.</li>
</ul>
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">autoInject</span>(<span class="hljs-params">tasks, callback</span>) </span>{
    <span class="hljs-keyword">var</span> newTasks = {};

    (<span class="hljs-number">0</span>, _baseForOwn2.default)(tasks, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">taskFn, key</span>) </span>{
        <span class="hljs-keyword">var</span> params;
        <span class="hljs-keyword">var</span> fnIsAsync = (<span class="hljs-number">0</span>, _wrapAsync.isAsync)(taskFn);
        <span class="hljs-keyword">var</span> hasNoDeps = !fnIsAsync &amp;&amp; taskFn.length === <span class="hljs-number">1</span> || fnIsAsync &amp;&amp; taskFn.length === <span class="hljs-number">0</span>;

        <span class="hljs-keyword">if</span> ((<span class="hljs-number">0</span>, _isArray2.default)(taskFn)) {
            params = taskFn.slice(<span class="hljs-number">0</span>, <span class="hljs-number">-1</span>);
            taskFn = taskFn[taskFn.length - <span class="hljs-number">1</span>];

            newTasks[key] = params.concat(params.length &gt; <span class="hljs-number">0</span> ? newTask : taskFn);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (hasNoDeps) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>no dependencies, use the function as-is</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            newTasks[key] = taskFn;
        } <span class="hljs-keyword">else</span> {
            params = parseParams(taskFn);
            <span class="hljs-keyword">if</span> (taskFn.length === <span class="hljs-number">0</span> &amp;&amp; !fnIsAsync &amp;&amp; params.length === <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"autoInject task functions require explicit parameters."</span>);
            }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>remove callback param</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">if</span> (!fnIsAsync) params.pop();

            newTasks[key] = params.concat(newTask);
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">newTask</span>(<span class="hljs-params">results, taskCb</span>) </span>{
            <span class="hljs-keyword">var</span> newArgs = (<span class="hljs-number">0</span>, _arrayMap2.default)(params, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name</span>) </span>{
                <span class="hljs-keyword">return</span> results[name];
            });
            newArgs.push(taskCb);
            (<span class="hljs-number">0</span>, _wrapAsync2.default)(taskFn).apply(<span class="hljs-literal">null</span>, newArgs);
        }
    });

    (<span class="hljs-number">0</span>, _auto2.default)(newTasks, callback);
}
<span class="hljs-built_in">module</span>.exports = exports[<span class="hljs-string">'default'</span>];
</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
