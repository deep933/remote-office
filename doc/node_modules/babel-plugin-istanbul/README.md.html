<!DOCTYPE html>
<html>
<head>
  <title>README.md</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/babel-plugin-istanbul/README.md";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#babel-plugin-istanbul">babel-plugin-istanbul</a>
      </div>

      <div class="heading h2">
        <a href="#usage">Usage</a>
      </div>

      <div class="heading h2">
        <a href="#integrations">Integrations</a>
      </div>

      <div class="heading h3">
        <a href="#karma">karma</a>
      </div>

      <div class="heading h3">
        <a href="#mocha-on-node.js-through-nyc">mocha on node.js (through nyc)</a>
      </div>

      <div class="heading h2">
        <a href="#ignoring-files">Ignoring files</a>
      </div>

      <div class="heading h2">
        <a href="#source-maps">Source Maps</a>
      </div>

      <div class="heading h2">
        <a href="#credit-where-credit-is-due">Credit where credit is due</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="docs markdown"><div class="pilwrap" id="babel-plugin-istanbul">
  <h1>
    <a href="#babel-plugin-istanbul" name="babel-plugin-istanbul" class="pilcrow"></a>
babel-plugin-istanbul
  </h1>
</div>
<p><a href="https://greenkeeper.io/"><img src="https://badges.greenkeeper.io/istanbuljs/babel-plugin-istanbul.svg" alt="Greenkeeper badge"></a>
<a href="https://travis-ci.org/istanbuljs/babel-plugin-istanbul"><img src="https://travis-ci.org/istanbuljs/babel-plugin-istanbul.svg?branch=master" alt="Build Status"></a>
<a href="https://coveralls.io/github/istanbuljs/babel-plugin-istanbul?branch=master"><img src="https://coveralls.io/repos/github/istanbuljs/babel-plugin-istanbul/badge.svg?branch=master" alt="Coverage Status"></a>
<a href="https://conventionalcommits.org"><img src="https://img.shields.io/badge/Conventional%20Commits-1.0.0-yellow.svg" alt="Conventional Commits"></a>
<a href="http://devtoolscommunity.herokuapp.com"><img src="http://devtoolscommunity.herokuapp.com/badge.svg" alt="community slack"></a></p>
<p><em>Having problems? want to contribute? join our <a href="http://devtoolscommunity.herokuapp.com">community slack</a></em>.</p>
<p>A Babel plugin that instruments your code with Istanbul coverage.
It can instantly be used with <a href="https://github.com/karma-runner/karma-coverage">karma-coverage</a> and mocha on Node.js (through <a href="https://github.com/bcoe/nyc">nyc</a>).</p>
<p><strong>Note:</strong> This plugin does not generate any report or save any data to any file;
it only adds instrumenting code to your JavaScript source code.
To integrate with testing tools, please see the <a href="#integrations.html">Integrations</a> section.</p>
<div class="pilwrap" id="usage">
  <h2>
    <a href="#usage" name="usage" class="pilcrow"></a>
Usage
  </h2>
</div>
<p>Install it:</p>
<pre><code>npm install --save-dev babel-plugin-istanbul
</code></pre>
<p>Add it to <code>.babelrc</code> in test mode:</p>
<pre><code class="js">{
  <span class="hljs-string">"env"</span>: {
    <span class="hljs-string">"test"</span>: {
      <span class="hljs-string">"plugins"</span>: [ <span class="hljs-string">"istanbul"</span> ]
    }
  }
}
</code></pre>
<p>Optionally, use <a href="https://www.npmjs.com/package/cross-env">cross-env</a> to set
<code>NODE_ENV=test</code>:</p>
<pre><code class="json">{
  <span class="hljs-attr">"scripts"</span>: {
    <span class="hljs-attr">"test"</span>: <span class="hljs-string">"cross-env NODE_ENV=test nyc --reporter=lcov --reporter=text mocha test/*.js"</span>
  }
}
</code></pre>
<div class="pilwrap" id="integrations">
  <h2>
    <a href="#integrations" name="integrations" class="pilcrow"></a>
Integrations
  </h2>
</div>
<div class="pilwrap" id="karma">
  <h3>
    <a href="#karma" name="karma" class="pilcrow"></a>
karma
  </h3>
</div>
<p>It <em>just works</em> with Karma. First, make sure that the code is already transpiled by Babel (either using <code>karma-babel-preprocessor</code>, <code>karma-webpack</code>, or <code>karma-browserify</code>). Then, simply set up <a href="https://github.com/karma-runner/karma-coverage">karma-coverage</a> according to the docs, but <strong>donâ€™t add the <code>coverage</code> preprocessor.</strong> This plugin has already instrumented your code, and Karma should pick it up automatically.</p>
<p>It has been tested with <a href="https://codecov.io/github/bemusic/bemuse">bemusic/bemuse</a> project, which contains ~2400 statements.</p>
<div class="pilwrap" id="mocha-on-node.js-through-nyc">
  <h3>
    <a href="#mocha-on-node.js-through-nyc" name="mocha-on-node.js-through-nyc" class="pilcrow"></a>
mocha on node.js (through nyc)
  </h3>
</div>
<p>Configure Mocha to transpile JavaScript code using Babel, then you can run your tests with <a href="https://github.com/bcoe/nyc"><code>nyc</code></a>, which will collect all the coverage report.</p>
<p>babel-plugin-istanbul respects the <code>include</code>/<code>exclude</code> configuration options from nyc,
but you also need to <strong>configure NYC not to instrument your code</strong> by adding these settings in your <code>package.json</code>:</p>
<pre><code class="js">  <span class="hljs-string">"nyc"</span>: {
    <span class="hljs-string">"sourceMap"</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-string">"instrument"</span>: <span class="hljs-literal">false</span>
  },
</code></pre>
<div class="pilwrap" id="ignoring-files">
  <h2>
    <a href="#ignoring-files" name="ignoring-files" class="pilcrow"></a>
Ignoring files
  </h2>
</div>
<p>You don't want to cover your test files as this will skew your coverage results. You can configure this by providing plugin options matching nyc's <a href="https://github.com/bcoe/nyc#excluding-files"><code>exclude</code>/<code>include</code> rules</a>:</p>
<pre><code class="json">{
  <span class="hljs-attr">"env"</span>: {
    <span class="hljs-attr">"test"</span>: {
      <span class="hljs-attr">"plugins"</span>: [
        [<span class="hljs-string">"istanbul"</span>, {
          <span class="hljs-attr">"exclude"</span>: [
            <span class="hljs-string">"**/*.spec.js"</span>
          ]
        }]
      ]
    }
  }
}
</code></pre>
<p>If you don't provide options in your Babel config, the plugin will look for <code>exclude</code>/<code>include</code> config under an <code>&quot;nyc&quot;</code> key in <code>package.json</code>.</p>
<p>You can also use <a href="https://github.com/gotwarlost/istanbul/blob/master/ignoring-code-for-coverage.md#ignoring-code-for-coverage-purposes">istanbul's ignore hints</a> to specify specific lines of code to skip instrumenting.</p>
<div class="pilwrap" id="source-maps">
  <h2>
    <a href="#source-maps" name="source-maps" class="pilcrow"></a>
Source Maps
  </h2>
</div>
<p>By default, this plugin will pick up inline source maps and attach them to the instrumented code such that code coverage can be remapped back to the original source, even for multi-step build processes. This can be memory intensive. Set <code>useInlineSourceMaps</code> to prevent this behavior.</p>
<pre><code class="json">{
  <span class="hljs-attr">"env"</span>: {
    <span class="hljs-attr">"test"</span>: {
      <span class="hljs-attr">"plugins"</span>: [
        [<span class="hljs-string">"istanbul"</span>, {
          <span class="hljs-attr">"useInlineSourceMaps"</span>: <span class="hljs-literal">false</span>
        }]
      ]
    }
  }
}
</code></pre>
<p>If you're instrumenting code programatically, you can pass a source map explicitly.</p>
<pre><code class="js"><span class="hljs-keyword">import</span> babelPluginIstanbul <span class="hljs-keyword">from</span> <span class="hljs-string">'babel-plugin-istanbul'</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">instrument</span>(<span class="hljs-params">sourceCode, sourceMap, fileName</span>) </span>{
  <span class="hljs-keyword">return</span> babel.transform(sourceCode, {
    filename,
    <span class="hljs-attr">plugins</span>: [
      [babelPluginIstanbul, {
        <span class="hljs-attr">inputSourceMap</span>: sourceMap
      }]
    ]
  })
}
</code></pre>
<div class="pilwrap" id="credit-where-credit-is-due">
  <h2>
    <a href="#credit-where-credit-is-due" name="credit-where-credit-is-due" class="pilcrow"></a>
Credit where credit is due
  </h2>
</div>
<p>The approach used in <code>babel-plugin-istanbul</code> was inspired by <a href="https://github.com/dtinth">Thai Pangsakulyanont</a>'s original library <a href="https://github.com/dtinth/babel-plugin-__coverage__"><code>babel-plugin-__coverage__</code></a>.</p>
</div>
  </div>
</body>
</html>
