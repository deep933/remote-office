<!DOCTYPE html>
<html>
<head>
  <title>index.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/chardet/index.js";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>index.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

<span class="hljs-keyword">var</span> utf8  = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./encoding/utf8'</span>),
  unicode = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./encoding/unicode'</span>),
  mbcs    = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./encoding/mbcs'</span>),
  sbcs    = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./encoding/sbcs'</span>),
  iso2022 = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./encoding/iso2022'</span>);

<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;

<span class="hljs-keyword">var</span> recognisers = [
  <span class="hljs-keyword">new</span> utf8,
  <span class="hljs-keyword">new</span> unicode.UTF_16BE,
  <span class="hljs-keyword">new</span> unicode.UTF_16LE,
  <span class="hljs-keyword">new</span> unicode.UTF_32BE,
  <span class="hljs-keyword">new</span> unicode.UTF_32LE,
  <span class="hljs-keyword">new</span> mbcs.sjis,
  <span class="hljs-keyword">new</span> mbcs.big5,
  <span class="hljs-keyword">new</span> mbcs.euc_jp,
  <span class="hljs-keyword">new</span> mbcs.euc_kr,
  <span class="hljs-keyword">new</span> mbcs.gb_18030,
  <span class="hljs-keyword">new</span> iso2022.ISO_2022_JP,
  <span class="hljs-keyword">new</span> iso2022.ISO_2022_KR,
  <span class="hljs-keyword">new</span> iso2022.ISO_2022_CN,
  <span class="hljs-keyword">new</span> sbcs.ISO_8859_1,
  <span class="hljs-keyword">new</span> sbcs.ISO_8859_2,
  <span class="hljs-keyword">new</span> sbcs.ISO_8859_5,
  <span class="hljs-keyword">new</span> sbcs.ISO_8859_6,
  <span class="hljs-keyword">new</span> sbcs.ISO_8859_7,
  <span class="hljs-keyword">new</span> sbcs.ISO_8859_8,
  <span class="hljs-keyword">new</span> sbcs.ISO_8859_9,
  <span class="hljs-keyword">new</span> sbcs.windows_1251,
  <span class="hljs-keyword">new</span> sbcs.windows_1256,
  <span class="hljs-keyword">new</span> sbcs.KOI8_R
];

<span class="hljs-built_in">module</span>.exports.detect = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">buffer, opts</span>) </span>{

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>Tally up the byte occurence statistics.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> fByteStats = [];
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">256</span>; i++)
    fByteStats[i] = <span class="hljs-number">0</span>;

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = buffer.length - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--)
    fByteStats[buffer[i] &amp; <span class="hljs-number">0x00ff</span>]++;

  <span class="hljs-keyword">var</span> fC1Bytes = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0x80</span>; i &lt;= <span class="hljs-number">0x9F</span>; i += <span class="hljs-number">1</span>) {
    <span class="hljs-keyword">if</span> (fByteStats[i] != <span class="hljs-number">0</span>) {
      fC1Bytes = <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">break</span>;
    }
  }

  <span class="hljs-keyword">var</span> context = {
    <span class="hljs-attr">fByteStats</span>:  fByteStats,
    <span class="hljs-attr">fC1Bytes</span>:    fC1Bytes,
    <span class="hljs-attr">fRawInput</span>:   buffer,
    <span class="hljs-attr">fRawLength</span>:  buffer.length,
    <span class="hljs-attr">fInputBytes</span>: buffer,
    <span class="hljs-attr">fInputLen</span>:   buffer.length
  };

  <span class="hljs-keyword">var</span> matches = recognisers.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">rec</span>) </span>{
    <span class="hljs-keyword">return</span> rec.match(context);
  }).filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">match</span>) </span>{
    <span class="hljs-keyword">return</span> !!match;
  }).sort(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a, b</span>) </span>{
    <span class="hljs-keyword">return</span> b.confidence - a.confidence;
  });

  <span class="hljs-keyword">if</span> (opts &amp;&amp; opts.returnAllMatches === <span class="hljs-literal">true</span>) {
    <span class="hljs-keyword">return</span> matches;
  }
  <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> matches.length &gt; <span class="hljs-number">0</span> ? matches[<span class="hljs-number">0</span>].name : <span class="hljs-literal">null</span>;
  }
};

<span class="hljs-built_in">module</span>.exports.detectFile = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">filepath, opts, cb</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> opts === <span class="hljs-string">'function'</span>) {
    cb = opts;
    opts = <span class="hljs-literal">undefined</span>;
  }

  <span class="hljs-keyword">var</span> fd;

  <span class="hljs-keyword">var</span> handler = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, buffer</span>) </span>{
    <span class="hljs-keyword">if</span> (fd) {
      fs.closeSync(fd);
    }

    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> cb(err, <span class="hljs-literal">null</span>);
    cb(<span class="hljs-literal">null</span>, self.detect(buffer, opts));
  };

  <span class="hljs-keyword">if</span> (opts &amp;&amp; opts.sampleSize) {
    fd = fs.openSync(filepath, <span class="hljs-string">'r'</span>),
      sample = Buffer.allocUnsafe(opts.sampleSize);

    fs.read(fd, sample, <span class="hljs-number">0</span>, opts.sampleSize, <span class="hljs-literal">null</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) </span>{
      handler(err, sample);
    });
    <span class="hljs-keyword">return</span>;
  }

  fs.readFile(filepath, handler);
};

<span class="hljs-built_in">module</span>.exports.detectFileSync = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">filepath, opts</span>) </span>{
  <span class="hljs-keyword">if</span> (opts &amp;&amp; opts.sampleSize) {
    <span class="hljs-keyword">var</span> fd = fs.openSync(filepath, <span class="hljs-string">'r'</span>),
      sample = Buffer.allocUnsafe(opts.sampleSize);

    fs.readSync(fd, sample, <span class="hljs-number">0</span>, opts.sampleSize);
    fs.closeSync(fd);
    <span class="hljs-keyword">return</span> self.detect(sample, opts);
  }

  <span class="hljs-keyword">return</span> self.detect(fs.readFileSync(filepath), opts);
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>Wrappers for the previous functions to return all encodings</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-built_in">module</span>.exports.detectAll = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">buffer, opts</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> opts !== <span class="hljs-string">'object'</span>) {
    opts = {};
  }
  opts.returnAllMatches = <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">return</span> self.detect(buffer, opts);
}

<span class="hljs-built_in">module</span>.exports.detectFileAll = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">filepath, opts, cb</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> opts === <span class="hljs-string">'function'</span>) {
    cb = opts;
    opts = <span class="hljs-literal">undefined</span>;
  }
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> opts !== <span class="hljs-string">'object'</span>) {
    opts = {};
  }
  opts.returnAllMatches = <span class="hljs-literal">true</span>;
  self.detectFile(filepath, opts, cb);
}

<span class="hljs-built_in">module</span>.exports.detectFileAllSync = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">filepath, opts</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> opts !== <span class="hljs-string">'object'</span>) {
    opts = {};
  }
  opts.returnAllMatches = <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">return</span> self.detectFileSync(filepath, opts);
}

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
