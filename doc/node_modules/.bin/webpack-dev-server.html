<!DOCTYPE html>
<html>
<head>
  <title>webpack-dev-server</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/.bin/webpack-dev-server";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>webpack-dev-server</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">#!/usr/bin/env node</span>

<span class="hljs-meta">'use strict'</span>;

<span class="hljs-comment">/* eslint-disable no-shadow, no-console */</span>

<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">const</span> net = <span class="hljs-built_in">require</span>(<span class="hljs-string">'net'</span>);
<span class="hljs-keyword">const</span> debug = <span class="hljs-built_in">require</span>(<span class="hljs-string">'debug'</span>)(<span class="hljs-string">'webpack-dev-server'</span>);
<span class="hljs-keyword">const</span> importLocal = <span class="hljs-built_in">require</span>(<span class="hljs-string">'import-local'</span>);
<span class="hljs-keyword">const</span> yargs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'yargs'</span>);
<span class="hljs-keyword">const</span> webpack = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack'</span>);
<span class="hljs-keyword">const</span> Server = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../lib/Server'</span>);
<span class="hljs-keyword">const</span> setupExitSignals = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../lib/utils/setupExitSignals'</span>);
<span class="hljs-keyword">const</span> colors = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../lib/utils/colors'</span>);
<span class="hljs-keyword">const</span> processOptions = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../lib/utils/processOptions'</span>);
<span class="hljs-keyword">const</span> createLogger = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../lib/utils/createLogger'</span>);
<span class="hljs-keyword">const</span> getVersions = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../lib/utils/getVersions'</span>);
<span class="hljs-keyword">const</span> options = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./options'</span>);

<span class="hljs-keyword">let</span> server;
<span class="hljs-keyword">const</span> serverData = {
  <span class="hljs-attr">server</span>: <span class="hljs-literal">null</span>,
};
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>we must pass an object that contains the server object as a property so that
we can update this server property later, and setupExitSignals will be able to
recognize that the server has been instantiated, because we will set
serverData.server to the new server object.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">setupExitSignals(serverData);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>Prefer the local installation of webpack-dev-server</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">if</span> (importLocal(__filename)) {
  debug(<span class="hljs-string">'Using local install of webpack-dev-server'</span>);

  <span class="hljs-keyword">return</span>;
}

<span class="hljs-keyword">try</span> {
  <span class="hljs-built_in">require</span>.resolve(<span class="hljs-string">'webpack-cli'</span>);
} <span class="hljs-keyword">catch</span> (err) {
  <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'The CLI moved into a separate package: webpack-cli'</span>);
  <span class="hljs-built_in">console</span>.error(
    <span class="hljs-string">"Please install 'webpack-cli' in addition to webpack itself to use the CLI"</span>
  );
  <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'-&gt; When using npm: npm i -D webpack-cli'</span>);
  <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'-&gt; When using yarn: yarn add -D webpack-cli'</span>);

  process.exitCode = <span class="hljs-number">1</span>;
}

yargs.usage(
  <span class="hljs-string">`<span class="hljs-subst">${getVersions()}</span>\nUsage:  https://webpack.js.org/configuration/dev-server/`</span>
);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>webpack-cli@3.3 path : 'webpack-cli/bin/config/config-yargs'</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">let</span> configYargsPath;
<span class="hljs-keyword">try</span> {
  <span class="hljs-built_in">require</span>.resolve(<span class="hljs-string">'webpack-cli/bin/config/config-yargs'</span>);
  configYargsPath = <span class="hljs-string">'webpack-cli/bin/config/config-yargs'</span>;
} <span class="hljs-keyword">catch</span> (e) {
  configYargsPath = <span class="hljs-string">'webpack-cli/bin/config-yargs'</span>;
}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>eslint-disable-next-line import/no-extraneous-dependencies
eslint-disable-next-line import/no-dynamic-require</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-built_in">require</span>(configYargsPath)(yargs);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>It is important that this is done after the webpack yargs config,
so it overrides webpack's version info.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">yargs.version(getVersions());
yargs.options(options);

<span class="hljs-keyword">const</span> argv = yargs.argv;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>webpack-cli@3.3 path : 'webpack-cli/bin/utils/convert-argv'</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">let</span> convertArgvPath;
<span class="hljs-keyword">try</span> {
  <span class="hljs-built_in">require</span>.resolve(<span class="hljs-string">'webpack-cli/bin/utils/convert-argv'</span>);
  convertArgvPath = <span class="hljs-string">'webpack-cli/bin/utils/convert-argv'</span>;
} <span class="hljs-keyword">catch</span> (e) {
  convertArgvPath = <span class="hljs-string">'webpack-cli/bin/convert-argv'</span>;
}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>eslint-disable-next-line import/no-extraneous-dependencies
eslint-disable-next-line import/no-dynamic-require</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> config = <span class="hljs-built_in">require</span>(convertArgvPath)(yargs, argv, {
  <span class="hljs-attr">outputFilename</span>: <span class="hljs-string">'/bundle.js'</span>,
});

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">startDevServer</span>(<span class="hljs-params">config, options</span>) </span>{
  <span class="hljs-keyword">const</span> log = createLogger(options);

  <span class="hljs-keyword">let</span> compiler;

  <span class="hljs-keyword">try</span> {
    compiler = webpack(config);
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-keyword">if</span> (err <span class="hljs-keyword">instanceof</span> webpack.WebpackOptionsValidationError) {
      log.error(colors.error(options.stats.colors, err.message));
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>eslint-disable-next-line no-process-exit</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      process.exit(<span class="hljs-number">1</span>);
    }

    <span class="hljs-keyword">throw</span> err;
  }

  <span class="hljs-keyword">try</span> {
    server = <span class="hljs-keyword">new</span> Server(compiler, options, log);
    serverData.server = server;
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-keyword">if</span> (err.name === <span class="hljs-string">'ValidationError'</span>) {
      log.error(colors.error(options.stats.colors, err.message));
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>eslint-disable-next-line no-process-exit</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      process.exit(<span class="hljs-number">1</span>);
    }

    <span class="hljs-keyword">throw</span> err;
  }

  <span class="hljs-keyword">if</span> (options.socket) {
    server.listeningApp.on(<span class="hljs-string">'error'</span>, (e) =&gt; {
      <span class="hljs-keyword">if</span> (e.code === <span class="hljs-string">'EADDRINUSE'</span>) {
        <span class="hljs-keyword">const</span> clientSocket = <span class="hljs-keyword">new</span> net.Socket();

        clientSocket.on(<span class="hljs-string">'error'</span>, (err) =&gt; {
          <span class="hljs-keyword">if</span> (err.code === <span class="hljs-string">'ECONNREFUSED'</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>No other server listening on this socket so it can be safely removed</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            fs.unlinkSync(options.socket);

            server.listen(options.socket, options.host, (error) =&gt; {
              <span class="hljs-keyword">if</span> (error) {
                <span class="hljs-keyword">throw</span> error;
              }
            });
          }
        });

        clientSocket.connect({ <span class="hljs-attr">path</span>: options.socket }, () =&gt; {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'This socket is already used'</span>);
        });
      }
    });

    server.listen(options.socket, options.host, (err) =&gt; {
      <span class="hljs-keyword">if</span> (err) {
        <span class="hljs-keyword">throw</span> err;
      }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>chmod 666 (rw rw rw)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">const</span> READ_WRITE = <span class="hljs-number">438</span>;

      fs.chmod(options.socket, READ_WRITE, (err) =&gt; {
        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-keyword">throw</span> err;
        }
      });
    });
  } <span class="hljs-keyword">else</span> {
    server.listen(options.port, options.host, (err) =&gt; {
      <span class="hljs-keyword">if</span> (err) {
        <span class="hljs-keyword">throw</span> err;
      }
    });
  }
}

processOptions(config, argv, (config, options) =&gt; {
  startDevServer(config, options);
});

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
