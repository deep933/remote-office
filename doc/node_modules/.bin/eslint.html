<!DOCTYPE html>
<html>
<head>
  <title>eslint</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/.bin/eslint";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h2">
        <a href="#helpers">Helpers</a>
      </div>

      <div class="heading h2">
        <a href="#requirements">Requirements</a>
      </div>

      <div class="heading h2">
        <a href="#execution">Execution</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>eslint</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">#!/usr/bin/env node</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-comment">/* eslint no-console:off */</span>

<span class="hljs-meta">"use strict"</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>to use V8's code cache to speed up instantiation time</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-built_in">require</span>(<span class="hljs-string">"v8-compile-cache"</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <hr>
<div class="pilwrap" id="helpers">
  <h2>
    <a href="#helpers" name="helpers" class="pilcrow"></a>
Helpers
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">const</span> useStdIn = process.argv.includes(<span class="hljs-string">"--stdin"</span>),
    init = process.argv.includes(<span class="hljs-string">"--init"</span>),
    debug = process.argv.includes(<span class="hljs-string">"--debug"</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>must do this initialization <em>before</em> other requires in order to work</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">if</span> (debug) {
    <span class="hljs-built_in">require</span>(<span class="hljs-string">"debug"</span>).enable(<span class="hljs-string">"eslint:*,-eslint:code-path"</span>);
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <hr>
<div class="pilwrap" id="requirements">
  <h2>
    <a href="#requirements" name="requirements" class="pilcrow"></a>
Requirements
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>now we can safely include the other modules that use debug</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>),
    fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fs"</span>),
    cli = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../lib/cli"</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <hr>
<div class="pilwrap" id="execution">
  <h2>
    <a href="#execution" name="execution" class="pilcrow"></a>
Execution
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
process.once(<span class="hljs-string">"uncaughtException"</span>, err =&gt; {

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>lazy load</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> lodash = <span class="hljs-built_in">require</span>(<span class="hljs-string">"lodash"</span>);

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> err.messageTemplate === <span class="hljs-string">"string"</span> &amp;&amp; err.messageTemplate.length &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">const</span> template = lodash.template(fs.readFileSync(path.resolve(__dirname, <span class="hljs-string">`../messages/<span class="hljs-subst">${err.messageTemplate}</span>.txt`</span>), <span class="hljs-string">"utf-8"</span>));
        <span class="hljs-keyword">const</span> pkg = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../package.json"</span>);

        <span class="hljs-built_in">console</span>.error(<span class="hljs-string">"\nOops! Something went wrong! :("</span>);
        <span class="hljs-built_in">console</span>.error(<span class="hljs-string">`\nESLint: <span class="hljs-subst">${pkg.version}</span>.\n\n<span class="hljs-subst">${template(err.messageData || {}</span>)}`</span>);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-built_in">console</span>.error(err.stack);
    }

    process.exitCode = <span class="hljs-number">2</span>;
});

<span class="hljs-keyword">if</span> (useStdIn) {

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<div class="dox">
<div class="summary">
<p>Note: See</p>
<ul>
<li>https://github.com/nodejs/node/blob/master/doc/api/process.md#processstdin</li>
<li>https://github.com/nodejs/node/blob/master/doc/api/process.md#a-note-on-process-io</li>
<li>https://lists.gnu.org/archive/html/bug-gnu-emacs/2016-01/msg00419.html</li>
<li>https://github.com/nodejs/node/issues/7439 (historical)</li>
</ul>
</div>
<div class="body">
<p>On Windows using <code>fs.readFileSync(STDIN_FILE_DESCRIPTOR, &quot;utf8&quot;)</code> seems
to read 4096 bytes before blocking and never drains to read further data.</p>
<p>The investigation on the Emacs thread indicates:</p>
<blockquote>
<p>Emacs on MS-Windows uses pipes to communicate with subprocesses; a
pipe on Windows has a 4K buffer. So as soon as Emacs writes more than
4096 bytes to the pipe, the pipe becomes full, and Emacs then waits for
the subprocess to read its end of the pipe, at which time Emacs will
write the rest of the stuff.</p>
</blockquote>
<p>Using the nodejs code example for reading from stdin.</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">let</span> contents = <span class="hljs-string">""</span>,
        chunk = <span class="hljs-string">""</span>;

    process.stdin.setEncoding(<span class="hljs-string">"utf8"</span>);
    process.stdin.on(<span class="hljs-string">"readable"</span>, () =&gt; {

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>Use a loop to make sure we read all available data.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">while</span> ((chunk = process.stdin.read()) !== <span class="hljs-literal">null</span>) {
            contents += chunk;
        }
    });

    process.stdin.on(<span class="hljs-string">"end"</span>, () =&gt; {
        process.exitCode = cli.execute(process.argv, contents, <span class="hljs-string">"utf8"</span>);
    });
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (init) {
    <span class="hljs-keyword">const</span> configInit = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../lib/init/config-initializer"</span>);

    configInit.initializeConfig().then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        process.exitCode = <span class="hljs-number">0</span>;
    }).catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
        process.exitCode = <span class="hljs-number">1</span>;
        <span class="hljs-built_in">console</span>.error(err.message);
        <span class="hljs-built_in">console</span>.error(err.stack);
    });
} <span class="hljs-keyword">else</span> {
    process.exitCode = cli.execute(process.argv);
}

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
