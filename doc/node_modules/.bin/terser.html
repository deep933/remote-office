<!DOCTYPE html>
<html>
<head>
  <title>terser</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/.bin/terser";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>terser</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">#!/usr/bin/env node</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>-<em>- js -</em>-</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-comment">/* eslint-env node */</span>

<span class="hljs-meta">"use strict"</span>;

<span class="hljs-built_in">require</span>(<span class="hljs-string">"../tools/exit.js"</span>);

<span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fs"</span>);
<span class="hljs-keyword">var</span> info = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../package.json"</span>);
<span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>);
<span class="hljs-keyword">var</span> program = <span class="hljs-built_in">require</span>(<span class="hljs-string">"commander"</span>);

<span class="hljs-keyword">var</span> Terser = <span class="hljs-built_in">require</span>(<span class="hljs-string">".."</span>);
<span class="hljs-keyword">try</span> {
    <span class="hljs-built_in">require</span>(<span class="hljs-string">"source-map-support"</span>).install();
} <span class="hljs-keyword">catch</span> (err) {}

<span class="hljs-keyword">const</span> skip_keys = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Set</span>([ <span class="hljs-string">"cname"</span>, <span class="hljs-string">"parent_scope"</span>, <span class="hljs-string">"scope"</span>, <span class="hljs-string">"uses_eval"</span>, <span class="hljs-string">"uses_with"</span>, <span class="hljs-string">"_var_name_cache"</span> ]);
<span class="hljs-keyword">var</span> files = {};
<span class="hljs-keyword">var</span> options = {
    <span class="hljs-attr">compress</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">mangle</span>: <span class="hljs-literal">false</span>
};
program.version(info.name + <span class="hljs-string">" "</span> + info.version);
program.parseArgv = program.parse;
program.parse = <span class="hljs-literal">undefined</span>;
<span class="hljs-keyword">if</span> (process.argv.includes(<span class="hljs-string">"ast"</span>)) program.helpInformation = describe_ast;
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (process.argv.includes(<span class="hljs-string">"options"</span>)) program.helpInformation = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> text = [];
    <span class="hljs-keyword">var</span> options = Terser.default_options();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> option <span class="hljs-keyword">in</span> options) {
        text.push(<span class="hljs-string">"--"</span> + (option === <span class="hljs-string">"output"</span> ? <span class="hljs-string">"beautify"</span> : option === <span class="hljs-string">"sourceMap"</span> ? <span class="hljs-string">"source-map"</span> : option) + <span class="hljs-string">" options:"</span>);
        text.push(format_object(options[option]));
        text.push(<span class="hljs-string">""</span>);
    }
    <span class="hljs-keyword">return</span> text.join(<span class="hljs-string">"\n"</span>);
};
program.option(<span class="hljs-string">"-p, --parse &lt;options&gt;"</span>, <span class="hljs-string">"Specify parser options."</span>, parse_js());
program.option(<span class="hljs-string">"-c, --compress [options]"</span>, <span class="hljs-string">"Enable compressor/specify compressor options."</span>, parse_js());
program.option(<span class="hljs-string">"-m, --mangle [options]"</span>, <span class="hljs-string">"Mangle names/specify mangler options."</span>, parse_js());
program.option(<span class="hljs-string">"--mangle-props [options]"</span>, <span class="hljs-string">"Mangle properties/specify mangler options."</span>, parse_js());
program.option(<span class="hljs-string">"-b, --beautify [options]"</span>, <span class="hljs-string">"Beautify output/specify output options."</span>, parse_js());
program.option(<span class="hljs-string">"-o, --output &lt;file&gt;"</span>, <span class="hljs-string">"Output file (default STDOUT)."</span>);
program.option(<span class="hljs-string">"--comments [filter]"</span>, <span class="hljs-string">"Preserve copyright comments in the output."</span>);
program.option(<span class="hljs-string">"--config-file &lt;file&gt;"</span>, <span class="hljs-string">"Read minify() options from JSON file."</span>);
program.option(<span class="hljs-string">"-d, --define &lt;expr&gt;[=value]"</span>, <span class="hljs-string">"Global definitions."</span>, parse_js(<span class="hljs-string">"define"</span>));
program.option(<span class="hljs-string">"--ecma &lt;version&gt;"</span>, <span class="hljs-string">"Specify ECMAScript release: 5, 2015, 2016 or 2017..."</span>);
program.option(<span class="hljs-string">"-e, --enclose [arg[,...][:value[,...]]]"</span>, <span class="hljs-string">"Embed output in a big function with configurable arguments and values."</span>);
program.option(<span class="hljs-string">"--ie8"</span>, <span class="hljs-string">"Support non-standard Internet Explorer 8."</span>);
program.option(<span class="hljs-string">"--keep-classnames"</span>, <span class="hljs-string">"Do not mangle/drop class names."</span>);
program.option(<span class="hljs-string">"--keep-fnames"</span>, <span class="hljs-string">"Do not mangle/drop function names. Useful for code relying on Function.prototype.name."</span>);
program.option(<span class="hljs-string">"--module"</span>, <span class="hljs-string">"Input is an ES6 module"</span>);
program.option(<span class="hljs-string">"--name-cache &lt;file&gt;"</span>, <span class="hljs-string">"File to hold mangled name mappings."</span>);
program.option(<span class="hljs-string">"--rename"</span>, <span class="hljs-string">"Force symbol expansion."</span>);
program.option(<span class="hljs-string">"--no-rename"</span>, <span class="hljs-string">"Disable symbol expansion."</span>);
program.option(<span class="hljs-string">"--safari10"</span>, <span class="hljs-string">"Support non-standard Safari 10."</span>);
program.option(<span class="hljs-string">"--source-map [options]"</span>, <span class="hljs-string">"Enable source map/specify source map options."</span>, parse_js());
program.option(<span class="hljs-string">"--timings"</span>, <span class="hljs-string">"Display operations run time on STDERR."</span>);
program.option(<span class="hljs-string">"--toplevel"</span>, <span class="hljs-string">"Compress and/or mangle variables in toplevel scope."</span>);
program.option(<span class="hljs-string">"--verbose"</span>, <span class="hljs-string">"Print diagnostic messages."</span>);
program.option(<span class="hljs-string">"--warn"</span>, <span class="hljs-string">"Print warning messages."</span>);
program.option(<span class="hljs-string">"--wrap &lt;name&gt;"</span>, <span class="hljs-string">"Embed everything as a function with “exports” corresponding to “name” globally."</span>);
program.arguments(<span class="hljs-string">"[files...]"</span>).parseArgv(process.argv);
<span class="hljs-keyword">if</span> (program.configFile) {
    options = <span class="hljs-built_in">JSON</span>.parse(read_file(program.configFile));
}
<span class="hljs-keyword">if</span> (!program.output &amp;&amp; program.sourceMap &amp;&amp; program.sourceMap.url != <span class="hljs-string">"inline"</span>) {
    fatal(<span class="hljs-string">"ERROR: cannot write source map to STDOUT"</span>);
}
[
    <span class="hljs-string">"compress"</span>,
    <span class="hljs-string">"enclose"</span>,
    <span class="hljs-string">"ie8"</span>,
    <span class="hljs-string">"mangle"</span>,
    <span class="hljs-string">"module"</span>,
    <span class="hljs-string">"safari10"</span>,
    <span class="hljs-string">"sourceMap"</span>,
    <span class="hljs-string">"toplevel"</span>,
    <span class="hljs-string">"wrap"</span>
].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>) </span>{
    <span class="hljs-keyword">if</span> (name <span class="hljs-keyword">in</span> program) {
        options[name] = program[name];
    }
});
<span class="hljs-keyword">if</span> (<span class="hljs-string">"ecma"</span> <span class="hljs-keyword">in</span> program) {
    <span class="hljs-keyword">if</span> (program.ecma != (program.ecma | <span class="hljs-number">0</span>)) fatal(<span class="hljs-string">"ERROR: ecma must be an integer"</span>);
    <span class="hljs-keyword">const</span> ecma = program.ecma | <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span> (ecma &gt; <span class="hljs-number">5</span> &amp;&amp; ecma &lt; <span class="hljs-number">2015</span>)
        options.ecma = ecma + <span class="hljs-number">2009</span>;
    <span class="hljs-keyword">else</span>
        options.ecma = ecma;
}
<span class="hljs-keyword">if</span> (program.beautify) {
    options.output = <span class="hljs-keyword">typeof</span> program.beautify == <span class="hljs-string">"object"</span> ? program.beautify : {};
    <span class="hljs-keyword">if</span> (!(<span class="hljs-string">"beautify"</span> <span class="hljs-keyword">in</span> options.output)) {
        options.output.beautify = <span class="hljs-literal">true</span>;
    }
}
<span class="hljs-keyword">if</span> (program.comments) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> options.output != <span class="hljs-string">"object"</span>) options.output = {};
    options.output.comments = <span class="hljs-keyword">typeof</span> program.comments == <span class="hljs-string">"string"</span> ? (program.comments == <span class="hljs-string">"false"</span> ? <span class="hljs-literal">false</span> : program.comments) : <span class="hljs-string">"some"</span>;
}
<span class="hljs-keyword">if</span> (program.define) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> options.compress != <span class="hljs-string">"object"</span>) options.compress = {};
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> options.compress.global_defs != <span class="hljs-string">"object"</span>) options.compress.global_defs = {};
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> expr <span class="hljs-keyword">in</span> program.define) {
        options.compress.global_defs[expr] = program.define[expr];
    }
}
<span class="hljs-keyword">if</span> (program.keepClassnames) {
    options.keep_classnames = <span class="hljs-literal">true</span>;
}
<span class="hljs-keyword">if</span> (program.keepFnames) {
    options.keep_fnames = <span class="hljs-literal">true</span>;
}
<span class="hljs-keyword">if</span> (program.mangleProps) {
    <span class="hljs-keyword">if</span> (program.mangleProps.domprops) {
        <span class="hljs-keyword">delete</span> program.mangleProps.domprops;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> program.mangleProps != <span class="hljs-string">"object"</span>) program.mangleProps = {};
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">Array</span>.isArray(program.mangleProps.reserved)) program.mangleProps.reserved = [];
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> options.mangle != <span class="hljs-string">"object"</span>) options.mangle = {};
    options.mangle.properties = program.mangleProps;
}
<span class="hljs-keyword">if</span> (program.nameCache) {
    options.nameCache = <span class="hljs-built_in">JSON</span>.parse(read_file(program.nameCache, <span class="hljs-string">"{}"</span>));
}
<span class="hljs-keyword">if</span> (program.output == <span class="hljs-string">"ast"</span>) {
    options.output = {
        <span class="hljs-attr">ast</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">code</span>: <span class="hljs-literal">false</span>
    };
}
<span class="hljs-keyword">if</span> (program.parse) {
    <span class="hljs-keyword">if</span> (!program.parse.acorn &amp;&amp; !program.parse.spidermonkey) {
        options.parse = program.parse;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (program.sourceMap &amp;&amp; program.sourceMap.content == <span class="hljs-string">"inline"</span>) {
        fatal(<span class="hljs-string">"ERROR: inline source map only works with built-in parser"</span>);
    }
}
<span class="hljs-keyword">if</span> (~program.rawArgs.indexOf(<span class="hljs-string">"--rename"</span>)) {
    options.rename = <span class="hljs-literal">true</span>;
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!program.rename) {
    options.rename = <span class="hljs-literal">false</span>;
}
<span class="hljs-keyword">var</span> convert_path = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>) </span>{
    <span class="hljs-keyword">return</span> name;
};
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> program.sourceMap == <span class="hljs-string">"object"</span> &amp;&amp; <span class="hljs-string">"base"</span> <span class="hljs-keyword">in</span> program.sourceMap) {
    convert_path = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> base = program.sourceMap.base;
        <span class="hljs-keyword">delete</span> options.sourceMap.base;
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>) </span>{
            <span class="hljs-keyword">return</span> path.relative(base, name);
        };
    }();
}
<span class="hljs-keyword">if</span> (program.verbose) {
    options.warnings = <span class="hljs-string">"verbose"</span>;
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (program.warn) {
    options.warnings = <span class="hljs-literal">true</span>;
}

<span class="hljs-keyword">let</span> filesList;
<span class="hljs-keyword">if</span> (options.files &amp;&amp; options.files.length) {
    filesList = options.files;

    <span class="hljs-keyword">delete</span> options.files;
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (program.args.length) {
    filesList = program.args;
}

<span class="hljs-keyword">if</span> (filesList) {
    simple_glob(filesList).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>) </span>{
        files[convert_path(name)] = read_file(name);
    });
    run();
} <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">var</span> chunks = [];
    process.stdin.setEncoding(<span class="hljs-string">"utf8"</span>);
    process.stdin.on(<span class="hljs-string">"data"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">chunk</span>) </span>{
        chunks.push(chunk);
    }).on(<span class="hljs-string">"end"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        files = [ chunks.join(<span class="hljs-string">""</span>) ];
        run();
    });
    process.stdin.resume();
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">convert_ast</span>(<span class="hljs-params">fn</span>) </span>{
    <span class="hljs-keyword">return</span> Terser.AST_Node.from_mozilla_ast(<span class="hljs-built_in">Object</span>.keys(files).reduce(fn, <span class="hljs-literal">null</span>));
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">run</span>(<span class="hljs-params"></span>) </span>{
    Terser.AST_Node.warn_function = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">msg</span>) </span>{
        print_error(<span class="hljs-string">"WARN: "</span> + msg);
    };
    <span class="hljs-keyword">var</span> content = program.sourceMap &amp;&amp; program.sourceMap.content;
    <span class="hljs-keyword">if</span> (content &amp;&amp; content !== <span class="hljs-string">"inline"</span>) {
        options.sourceMap.content = read_file(content, content);
    }
    <span class="hljs-keyword">if</span> (program.timings) options.timings = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">if</span> (program.parse) {
            <span class="hljs-keyword">if</span> (program.parse.acorn) {
                files = convert_ast(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">toplevel, name</span>) </span>{
                    <span class="hljs-keyword">return</span> <span class="hljs-built_in">require</span>(<span class="hljs-string">"acorn"</span>).parse(files[name], {
                        <span class="hljs-attr">ecmaVersion</span>: <span class="hljs-number">2018</span>,
                        <span class="hljs-attr">locations</span>: <span class="hljs-literal">true</span>,
                        <span class="hljs-attr">program</span>: toplevel,
                        <span class="hljs-attr">sourceFile</span>: name,
                        <span class="hljs-attr">sourceType</span>: options.module || program.parse.module ? <span class="hljs-string">"module"</span> : <span class="hljs-string">"script"</span>
                    });
                });
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (program.parse.spidermonkey) {
                files = convert_ast(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">toplevel, name</span>) </span>{
                    <span class="hljs-keyword">var</span> obj = <span class="hljs-built_in">JSON</span>.parse(files[name]);
                    <span class="hljs-keyword">if</span> (!toplevel) <span class="hljs-keyword">return</span> obj;
                    toplevel.body = toplevel.body.concat(obj.body);
                    <span class="hljs-keyword">return</span> toplevel;
                });
            }
        }
    } <span class="hljs-keyword">catch</span> (ex) {
        fatal(ex);
    }
    <span class="hljs-keyword">var</span> result = Terser.minify(files, options);
    <span class="hljs-keyword">if</span> (result.error) {
        <span class="hljs-keyword">var</span> ex = result.error;
        <span class="hljs-keyword">if</span> (ex.name == <span class="hljs-string">"SyntaxError"</span>) {
            print_error(<span class="hljs-string">"Parse error at "</span> + ex.filename + <span class="hljs-string">":"</span> + ex.line + <span class="hljs-string">","</span> + ex.col);
            <span class="hljs-keyword">var</span> col = ex.col;
            <span class="hljs-keyword">var</span> lines = files[ex.filename].split(<span class="hljs-regexp">/\r?\n/</span>);
            <span class="hljs-keyword">var</span> line = lines[ex.line - <span class="hljs-number">1</span>];
            <span class="hljs-keyword">if</span> (!line &amp;&amp; !col) {
                line = lines[ex.line - <span class="hljs-number">2</span>];
                col = line.length;
            }
            <span class="hljs-keyword">if</span> (line) {
                <span class="hljs-keyword">var</span> limit = <span class="hljs-number">70</span>;
                <span class="hljs-keyword">if</span> (col &gt; limit) {
                    line = line.slice(col - limit);
                    col = limit;
                }
                print_error(line.slice(<span class="hljs-number">0</span>, <span class="hljs-number">80</span>));
                print_error(line.slice(<span class="hljs-number">0</span>, col).replace(<span class="hljs-regexp">/\S/g</span>, <span class="hljs-string">" "</span>) + <span class="hljs-string">"^"</span>);
            }
        }
        <span class="hljs-keyword">if</span> (ex.defs) {
            print_error(<span class="hljs-string">"Supported options:"</span>);
            print_error(format_object(ex.defs));
        }
        fatal(ex);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (program.output == <span class="hljs-string">"ast"</span>) {
        <span class="hljs-keyword">if</span> (!options.compress &amp;&amp; !options.mangle) {
            result.ast.figure_out_scope({});
        }
        print(<span class="hljs-built_in">JSON</span>.stringify(result.ast, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">key, value</span>) </span>{
            <span class="hljs-keyword">if</span> (value) <span class="hljs-keyword">switch</span> (key) {
              <span class="hljs-keyword">case</span> <span class="hljs-string">"thedef"</span>:
                <span class="hljs-keyword">return</span> symdef(value);
              <span class="hljs-keyword">case</span> <span class="hljs-string">"enclosed"</span>:
                <span class="hljs-keyword">return</span> value.length ? value.map(symdef) : <span class="hljs-literal">undefined</span>;
              <span class="hljs-keyword">case</span> <span class="hljs-string">"variables"</span>:
              <span class="hljs-keyword">case</span> <span class="hljs-string">"functions"</span>:
              <span class="hljs-keyword">case</span> <span class="hljs-string">"globals"</span>:
                <span class="hljs-keyword">return</span> value.size ? collect_from_map(value, symdef) : <span class="hljs-literal">undefined</span>;
            }
            <span class="hljs-keyword">if</span> (skip_keys.has(key)) <span class="hljs-keyword">return</span>;
            <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> Terser.AST_Token) <span class="hljs-keyword">return</span>;
            <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Map</span>) <span class="hljs-keyword">return</span>;
            <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> Terser.AST_Node) {
                <span class="hljs-keyword">var</span> result = {
                    <span class="hljs-attr">_class</span>: <span class="hljs-string">"AST_"</span> + value.TYPE
                };
                <span class="hljs-keyword">if</span> (value.block_scope) {
                    result.variables = value.block_scope.variables;
                    result.functions = value.block_scope.functions;
                    result.enclosed = value.block_scope.enclosed;
                }
                value.CTOR.PROPS.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">prop</span>) </span>{
                    <span class="hljs-keyword">if</span> (prop === <span class="hljs-string">"block_scope"</span>) <span class="hljs-keyword">return</span>;
                    result[prop] = value[prop];
                });
                <span class="hljs-keyword">return</span> result;
            }
            <span class="hljs-keyword">return</span> value;
        }, <span class="hljs-number">2</span>));
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (program.output == <span class="hljs-string">"spidermonkey"</span>) {
        print(<span class="hljs-built_in">JSON</span>.stringify(Terser.minify(result.code, {
            <span class="hljs-attr">compress</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">mangle</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">output</span>: {
                <span class="hljs-attr">ast</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">code</span>: <span class="hljs-literal">false</span>
            }
        }).ast.to_mozilla_ast(), <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>));
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (program.output) {
        fs.writeFileSync(program.output, result.code);
        <span class="hljs-keyword">if</span> (options.sourceMap.url !== <span class="hljs-string">"inline"</span> &amp;&amp; result.map) {
            fs.writeFileSync(program.output + <span class="hljs-string">".map"</span>, result.map);
        }
    } <span class="hljs-keyword">else</span> {
        print(result.code);
    }
    <span class="hljs-keyword">if</span> (program.nameCache) {
        fs.writeFileSync(program.nameCache, <span class="hljs-built_in">JSON</span>.stringify(options.nameCache));
    }
    <span class="hljs-keyword">if</span> (result.timings) <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> phase <span class="hljs-keyword">in</span> result.timings) {
        print_error(<span class="hljs-string">"- "</span> + phase + <span class="hljs-string">": "</span> + result.timings[phase].toFixed(<span class="hljs-number">3</span>) + <span class="hljs-string">"s"</span>);
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fatal</span>(<span class="hljs-params">message</span>) </span>{
    <span class="hljs-keyword">if</span> (message <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Error</span>) message = message.stack.replace(<span class="hljs-regexp">/^\S*?Error:/</span>, <span class="hljs-string">"ERROR:"</span>);
    print_error(message);
    process.exit(<span class="hljs-number">1</span>);
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>A file glob function that only supports &quot;*&quot; and &quot;?&quot; wildcards in the basename.
Example: &quot;foo/bar/<em>baz??.</em>.js&quot;
Argument <code>glob</code> may be a string or an array of strings.
Returns an array of strings. Garbage in, garbage out.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">simple_glob</span>(<span class="hljs-params">glob</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(glob)) {
        <span class="hljs-keyword">return</span> [].concat.apply([], glob.map(simple_glob));
    }
    <span class="hljs-keyword">if</span> (glob &amp;&amp; glob.match(<span class="hljs-regexp">/[*?]/</span>)) {
        <span class="hljs-keyword">var</span> dir = path.dirname(glob);
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">var</span> entries = fs.readdirSync(dir);
        } <span class="hljs-keyword">catch</span> (ex) {}
        <span class="hljs-keyword">if</span> (entries) {
            <span class="hljs-keyword">var</span> pattern = <span class="hljs-string">"^"</span> + path.basename(glob)
                .replace(<span class="hljs-regexp">/[.+^$[\]\\(){}]/g</span>, <span class="hljs-string">"\\$&amp;"</span>)
                .replace(<span class="hljs-regexp">/\*/g</span>, <span class="hljs-string">"[^/\\\\]*"</span>)
                .replace(<span class="hljs-regexp">/\?/g</span>, <span class="hljs-string">"[^/\\\\]"</span>) + <span class="hljs-string">"$"</span>;
            <span class="hljs-keyword">var</span> mod = process.platform === <span class="hljs-string">"win32"</span> ? <span class="hljs-string">"i"</span> : <span class="hljs-string">""</span>;
            <span class="hljs-keyword">var</span> rx = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(pattern, mod);
            <span class="hljs-keyword">var</span> results = entries.filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>) </span>{
                <span class="hljs-keyword">return</span> rx.test(name);
            }).map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>) </span>{
                <span class="hljs-keyword">return</span> path.join(dir, name);
            });
            <span class="hljs-keyword">if</span> (results.length) <span class="hljs-keyword">return</span> results;
        }
    }
    <span class="hljs-keyword">return</span> [ glob ];
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">read_file</span>(<span class="hljs-params">path, default_value</span>) </span>{
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">return</span> fs.readFileSync(path, <span class="hljs-string">"utf8"</span>);
    } <span class="hljs-keyword">catch</span> (ex) {
        <span class="hljs-keyword">if</span> ((ex.code == <span class="hljs-string">"ENOENT"</span> || ex.code == <span class="hljs-string">"ENAMETOOLONG"</span>) &amp;&amp; default_value != <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> default_value;
        fatal(ex);
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parse_js</span>(<span class="hljs-params">flag</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">value, options</span>) </span>{
        options = options || {};
        <span class="hljs-keyword">try</span> {
            Terser.parse(value, {
                <span class="hljs-attr">expression</span>: <span class="hljs-literal">true</span>
            }).walk(<span class="hljs-keyword">new</span> Terser.TreeWalker(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">node</span>) </span>{
                <span class="hljs-keyword">if</span> (node <span class="hljs-keyword">instanceof</span> Terser.AST_Assign) {
                    <span class="hljs-keyword">var</span> name = node.left.print_to_string();
                    <span class="hljs-keyword">var</span> value = node.right;
                    <span class="hljs-keyword">if</span> (flag) {
                        options[name] = value;
                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> Terser.AST_Array) {
                        options[name] = value.elements.map(to_string);
                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> Terser.AST_RegExp) {
                        value = value.value;
                        options[name] = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(value.source, value.flags);
                    } <span class="hljs-keyword">else</span> {
                        options[name] = to_string(value);
                    }
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
                <span class="hljs-keyword">if</span> (node <span class="hljs-keyword">instanceof</span> Terser.AST_Symbol || node <span class="hljs-keyword">instanceof</span> Terser.AST_PropAccess) {
                    <span class="hljs-keyword">var</span> name = node.print_to_string();
                    options[name] = <span class="hljs-literal">true</span>;
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
                <span class="hljs-keyword">if</span> (!(node <span class="hljs-keyword">instanceof</span> Terser.AST_Sequence)) <span class="hljs-keyword">throw</span> node;

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">to_string</span>(<span class="hljs-params">value</span>) </span>{
                    <span class="hljs-keyword">return</span> value <span class="hljs-keyword">instanceof</span> Terser.AST_Constant ? value.getValue() : value.print_to_string({
                        <span class="hljs-attr">quote_keys</span>: <span class="hljs-literal">true</span>
                    });
                }
            }));
        } <span class="hljs-keyword">catch</span>(ex) {
            <span class="hljs-keyword">if</span> (flag) {
                fatal(<span class="hljs-string">"Error parsing arguments for '"</span> + flag + <span class="hljs-string">"': "</span> + value);
            } <span class="hljs-keyword">else</span> {
                options[value] = <span class="hljs-literal">null</span>;
            }
        }
        <span class="hljs-keyword">return</span> options;
    };
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">symdef</span>(<span class="hljs-params">def</span>) </span>{
    <span class="hljs-keyword">var</span> ret = (<span class="hljs-number">1e6</span> + def.id) + <span class="hljs-string">" "</span> + def.name;
    <span class="hljs-keyword">if</span> (def.mangled_name) ret += <span class="hljs-string">" "</span> + def.mangled_name;
    <span class="hljs-keyword">return</span> ret;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">collect_from_map</span>(<span class="hljs-params">map, callback</span>) </span>{
    <span class="hljs-keyword">var</span> result = [];
    map.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">def</span>) </span>{
        result.push(callback(def));
    });
    <span class="hljs-keyword">return</span> result;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">format_object</span>(<span class="hljs-params">obj</span>) </span>{
    <span class="hljs-keyword">var</span> lines = [];
    <span class="hljs-keyword">var</span> padding = <span class="hljs-string">""</span>;
    <span class="hljs-built_in">Object</span>.keys(obj).map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>) </span>{
        <span class="hljs-keyword">if</span> (padding.length &lt; name.length) padding = <span class="hljs-built_in">Array</span>(name.length + <span class="hljs-number">1</span>).join(<span class="hljs-string">" "</span>);
        <span class="hljs-keyword">return</span> [ name, <span class="hljs-built_in">JSON</span>.stringify(obj[name]) ];
    }).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">tokens</span>) </span>{
        lines.push(<span class="hljs-string">"  "</span> + tokens[<span class="hljs-number">0</span>] + padding.slice(tokens[<span class="hljs-number">0</span>].length - <span class="hljs-number">2</span>) + tokens[<span class="hljs-number">1</span>]);
    });
    <span class="hljs-keyword">return</span> lines.join(<span class="hljs-string">"\n"</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">print_error</span>(<span class="hljs-params">msg</span>) </span>{
    process.stderr.write(msg);
    process.stderr.write(<span class="hljs-string">"\n"</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">print</span>(<span class="hljs-params">txt</span>) </span>{
    process.stdout.write(txt);
    process.stdout.write(<span class="hljs-string">"\n"</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">describe_ast</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> out = Terser.OutputStream({ <span class="hljs-attr">beautify</span>: <span class="hljs-literal">true</span> });
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doitem</span>(<span class="hljs-params">ctor</span>) </span>{
        out.print(<span class="hljs-string">"AST_"</span> + ctor.TYPE);
        <span class="hljs-keyword">var</span> props = ctor.SELF_PROPS.filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">prop</span>) </span>{
            <span class="hljs-keyword">return</span> !<span class="hljs-regexp">/^\$/</span>.test(prop);
        });
        <span class="hljs-keyword">if</span> (props.length &gt; <span class="hljs-number">0</span>) {
            out.space();
            out.with_parens(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                props.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">prop, i</span>) </span>{
                    <span class="hljs-keyword">if</span> (i) out.space();
                    out.print(prop);
                });
            });
        }
        <span class="hljs-keyword">if</span> (ctor.documentation) {
            out.space();
            out.print_string(ctor.documentation);
        }
        <span class="hljs-keyword">if</span> (ctor.SUBCLASSES.length &gt; <span class="hljs-number">0</span>) {
            out.space();
            out.with_block(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                ctor.SUBCLASSES.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ctor, i</span>) </span>{
                    out.indent();
                    doitem(ctor);
                    out.newline();
                });
            });
        }
    }
    doitem(Terser.AST_Node);
    <span class="hljs-keyword">return</span> out + <span class="hljs-string">"\n"</span>;
}

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
